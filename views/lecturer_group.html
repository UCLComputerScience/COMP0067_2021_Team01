
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Voltage &mdash; 100% Free Fully Responsive HTML5 Template by FREEHTML5.co</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Free HTML5 Template by FREEHTML5.CO" />
	<meta name="keywords" content="free html5, free template, free bootstrap, html5, css3, mobile first, responsive" />
	<meta name="author" content="FREEHTML5.CO" />

  	<!-- 
	//////////////////////////////////////////////////////

	FREE HTML5 TEMPLATE 
	DESIGNED & DEVELOPED by FREEHTML5.CO
		
	Website: 		http://freehtml5.co/
	Email: 			info@freehtml5.co
	Twitter: 		http://twitter.com/fh5co
	Facebook: 		https://www.facebook.com/fh5co

	//////////////////////////////////////////////////////
	-->

  	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />
	<style>
		.menu li {
			list-style:none;
			float:left;
			width:90px;
			overflow:visible;
			cursor:pointer;
		}

		ul.level2 {
			width:90px;
			display:none;
		}
		ul.level2 {
			margin:-28px 0 0 90px;
		}
		li.imyeah:hover > ul, ul.level2 > li.imyeah:hover > ul {
			display:block;
		}
		.fh5co-nav-style-1 .dropdown .dropdown-menu {
			border: 1px solid #0b2e13;
			background:#0f6674;
		}
		.font1 {
			font-weight: bold;
			color: #000000;
		}
		.font2 {
			font-weight: normal;
			color: #495057;
		}
		.date_unit {
			width: 9rem;
		}
		#team_score_plot {
			border: 1px solid #c0a16b;
			width: 90%;
			height: 300px;
			margin-left: auto;
			margin-right: auto;
			float: left;
		}
		.table-responsive th, .table-modal th {
			text-align: center;
		}
		.table-responsive td, .table-modal td {
			text-align: center;
		}
	</style>

	<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
	<link rel="shortcut icon" href="/public/favicon.ico">
	
	<!-- Google Fonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700|Monsterrat:400,700|Merriweather:400,300italic,700' rel='stylesheet' type='text/css'>
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="/public/css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="/public/css/icomoon.css">
	<!-- Magnific Popup-->
	<link rel="stylesheet" href="/public/css/magnific-popup.css">
	<!-- Owl Carousel -->
	<link rel="stylesheet" href="/public/css/owl.carousel.min.css">
	<link rel="stylesheet" href="/public/css/owl.theme.default.min.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="/public/css/bootstrap.css">
	
	<!-- Cards -->
	<link rel="stylesheet" href="/public/css/cards.css">

	<!-- Modernizr JS -->
	<script src="/public/js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="/public/js/respond.min.js"></script>
	<![endif]-->

<!--table-->
<!--	<link href="/public/css/styles.css" rel="stylesheet" />-->
	<link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet" crossorigin="anonymous" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/js/all.min.js" crossorigin="anonymous"></script>


	</head>
	<body>
<!--Navigation bar-->
	<div id="">
		<nav class="fh5co-nav-style-1" role="navigation" data-offcanvass-position="fh5co-offcanvass-left" style="background-image: url(/public/images/moodle.jpg)">
			<div class="container">
				<div class="col-lg-3 col-md-3 col-sm-3 col-xs-12 fh5co-logo">
					<a href="#" class="js-fh5co-mobile-toggle fh5co-nav-toggle"><i></i></a>
					<a href="#">Traffic Light Feedback System</a>
				</div>
				<div class="col-lg-5 col-md-5 col-sm-5 text-center fh5co-link-wrap">
					<ul data-offcanvass="yes">
						<li><a href="lecturer_homepage" style="margin-left: 0;">Home</a></li>
						<li class="dropdown active">
							<a class="dropdown-toggle" data-toggle="dropdown">Module({{YS}})<span class="caret"></span></a>
							<ul class="dropdown-menu" role="menu" >
								<div class="fh5co-link-wrap">
									{{each modules}}
									<li><a href="lecturer_module?moduleID={{$value.moduleCode}}&YT={{$value.yearTerm}}">{{$value.moduleCode}}</a></li>
									{{/each}}
								</div>
							</ul>
						</li>
						<li class="dropdown">
							<a class="dropdown-toggle" data-toggle="dropdown">Semester<span class="caret"></span></a>
							<ul class="dropdown-menu" role="menu" >
								<div class="fh5co-link-wrap" style="width: 145px; text-align: center" id="year_semester">

								</div>
							</ul>
						</li>
						<li><a href="lecturer_admin">Admin</a></li>
					</ul>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 text-right fh5co-link-wrap">
					<ul class="fh5co-special" data-offcanvass="yes">
						<li><a href="#">Hi, {{uname}}</a></li>
						<li><a href="#" class="call-to-action" data-toggle="modal" data-target="#logoutModal">Logout</a></li>
					</ul>
				</div>
			</div>
		</nav>

		<div class="fh5co-cover fh5co-cover-style-2" data-stellar-background-ratio="0" data-next="yes" style="background-image: url(/public/images/img_same_dimension_3.jpg);">
			<div class="fh5co-cover-text">
				<div class="container">
					<br><br><br><br><br>
					<nav class="navbar" role="navigation">
						<ol class="breadcrumb">
							<li class="li"><a href="lecturer_homepage">Home</a></li>
							<li class="li"><a href="lecturer_module?moduleID={{module.moduleCode}}">{{module.moduleName}}</a></li>
							<li class="active">Group feedback</li>
						</ol>
					</nav>
				</div>
				<div class="container wow fadeInUp" data-wow-duration="1s" data-wow-delay=".5s"  style="background-color: #f9f6f0; border: 1px solid #999999; margin:25px auto 25px auto">
					<div id="layoutSidenav_content">
						<br>
						<main>
							<div class="container-fluid">
								<div class="card mb-4">
									<div class="card-header">
										<div class="row">
											<div class="text-center">
												<div class="fh5co-cover-intro">
													<h1 class="cover-text-lead wow fadeInUp" data-wow-duration="1s" data-wow-delay="1.1s" style="color: #000000">Group {{teamNumber}} Feedback</h1>
												</div>
											</div>
										</div>
									</div>
									<div class="card-body">
										<div class="fade in active wow fadeInUp" data-wow-duration="1s" data-wow-delay="1.4s">
											<div class="row">
												<div class="container">
													<div class="col-md-6">
														<div style="width: 100%; display: block">
															{{each member}}
															<div class="text-center" style="display: block; float: left; position: relative; width:160px; height:200px">
																<img src="{{$value.fileLocation}}" width="130" height="160" >
																<div class="row text-center">
																	<h5><font class="font1">Member {{$value.memberIndex}}:</font><br><font class="font2">{{$value.forename}} {{$value.surname}}</font></h5>
																</div>
															</div>
															{{/each}}
														</div>
													</div>
													<div class="col-md-6">
														<div style="display: block; float: left; position: relative; width:100%; height: 100%">
															<figure class="highcharts-figure" style="margin:0 auto;">
																<!--															<p class="highcharts-description">Team Weekly Score</p>-->
																<div id="team_score_plot"></div>
															</figure>
														</div>
													</div>
												</div>
											</div>
											<div class="row" style="background-color: #ffffff; display: block; position: relative; margin:25px auto 25px auto">
												<br>
												<div class="table-responsive" style="margin:auto 25px auto 25px">
													<table class="table table-bordered" id="dataTable1" width="100%" cellspacing="0">
														<thead>
														<tr>
															<th style="vertical-align: middle">Week</th>
															<th style="vertical-align: middle">Group Score</th>
															<th style="vertical-align: middle">Individual Contributions</th>
															<th style="vertical-align: middle">Group Feedback</th>
															<th style="vertical-align: middle">Date</th>
															<th style="vertical-align: middle">Individual feedback</th>
														</tr>
														</thead>
														<tbody>
														{{each feedback}}
														<tr>
															<td style="vertical-align: middle">{{$value.weekNumber}}</td>
															<td style="vertical-align: middle" id="{{$value.weekNumber}}">{{$value.score}}</td>
															<td style="vertical-align: middle">{{$value.contributions}}%</td>
															<td style="vertical-align: middle" class="fd_unit">{{$value.writtenFeedback}}</td>
															<td style="vertical-align: middle" class="date_unit">{{$value.date}}</td>
															<td style="vertical-align: middle">
																<button href="#" class="call-to-action" data-toggle="modal" data-target="#feedback_{{$value.weekNumber}}">Feedback</button>
															</td>
														</tr>
														{{/each}}
														</tbody>
													</table>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</main>
					</div>
				</div>
			</div>
			<!--footer-->
			<div style="background-image: url(/public/images/moodle.jpg); height: 100px;">
				<div style="text-align: center; height: 100px; line-height: 100px;">
					<b style="color: #000000; font-size: 20px;">Copyright@UCL Department of Computer Science</b>
				</div>
			</div>
			<!-- END footer -->
		</div>
	</div>
	<!-- END page-->
	<input type="hidden" value="{{weeklyFeedback}}" id="weekly_feedback">
	<!--individual_feedback_form-->
	{{each feedback}}
	<div class="modal fade in active" id="feedback_{{$value.weekNumber}}" tabindex="-1" role="dialog" aria-labelledby="update_form_{{$value.weekNumber}}" aria-hidden="true">
		<div class="modal-dialog" role="document" style="width: 850px;">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="update_form_label">Individual feedback</h5>
					<button class="close" type="button" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<br>
				<form role="form" id="updateFeedback" action="/updateFeedback" method="post">
					<div class="modal-body">
						<div>
							<h3 style="text-align: center; color: #888888">WEEK {{$value.weekNumber}} GROUP {{teamNumber}}</h3>
						</div>
<!--						<div class="form-group">-->
<!--							<label for="teamNumber" class="col-form-label">Group Number</label>-->
<!--							<textarea id="teamNumber_update" type="text" rows="1" name="teamNumber" required readonly="readonly" class="form-control">{{$value.teamNumber}}</textarea>-->
<!--						</div>-->
<!--						<div class="form-group">-->
<!--							<label for="weekNumber" class="col-form-label">Week Number</label>-->
<!--							<textarea id="weekNumber_update" type="text" rows="1" name="weekNumber" required readonly="readonly" class="form-control">{{$value.weekNumber}}</textarea>-->
<!--						</div>-->
<!--						<div class="form-group">-->
<!--							<label for="teamScore" class="col-form-label">Group Score</label>-->
<!--							<div class="col-sm">-->
<!--								<select class="form-control" name="teamScore" id="teamScore">-->
<!--									<option value="{{$value.score}}">{{$value.score}}</option>-->
<!--									<option value="0">0</option>-->
<!--									<option value="1">1</option>-->
<!--									<option value="2">2</option>-->
<!--									<option value="3">3</option>-->
<!--									<option value="4">4</option>-->
<!--									<option value="5">5</option>-->
<!--								</select>-->
<!--								<small id="scoreHelp" class="form-text text-muted"><span class="text-dange">* Required.</span></small>-->
<!--							</div>-->
<!--						</div>-->
<!--						<div class="form-group">-->
<!--							<label>Group Feedback</label>-->
<!--							<textarea class="form-control" name="feedbackTeam" required rows="5" readonly="readonly">{{$value.writtenFeedback}}</textarea>-->
<!--						</div>-->
<!--						<div class="form-group">-->
<!--							<label>Message to Lecturer</label>-->
<!--							<textarea class="form-control" name="message" rows="5" readonly="readonly">{{$value.messageLecturer}}</textarea>-->
<!--						</div>-->
						<table class="table table-bordered table-modal">
							<thead>
							<tr>
								<th>Name</th>
								<th>Week</th>
								<th style="width: 7rem;">Score</th>
								<th class="Contribution">Contribution</th>
								<th>Individual Feedback</th>
							</tr>
							</thead>
							<tbody id="stu_feedback_html_week{{$value.weekNumber}}">

							</tbody>
						</table>
					</div>
					<div class="modal-footer form-group">
						<button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
<!--						<button class="btn btn-primary" type="submit">Submit</button>-->
					</div>
				</form>
			</div>
		</div>
	</div>
	{{/each}}

	<!-- Logout Modal-->
	<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		 aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
					<button class="close" type="button" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
				<div class="modal-footer">
					<button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
					<a class="btn btn-primary" href="login">Logout</a>
				</div>
			</div>
		</div>
	</div>


	<!-- jQuery -->
	<script src="/public/js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="/public/js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="/public/js/bootstrap.min.js"></script>
	<!-- Waypoints -->
    <script src="/public/js/jquery.waypoints.min.js"></script>
	<!-- Owl Carousel -->
	<script src="/public/js/owl.carousel.min.js"></script>
	<!-- Magnific Popup -->
	<script src="/public/js/jquery.magnific-popup.min.js"></script>
	<!-- Stellar -->
	<script src="/public/js/jquery.stellar.min.js"></script>
	<!-- countTo -->
	<script src="/public/js/jquery.countTo.js"></script>
	<!-- WOW -->
	<script src="/public/js/wow.min.js"></script>
	<script>
		new WOW().init();
	</script>
	<!--table-->
	<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
	<script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>
	<script src="/public/js/datatables-demo.js"></script>
	<!-- Main -->
	<script src="/public/js/main.js"></script>
	<!--plot-->
	<script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/modules/series-label.js"></script>
	<script src="https://code.highcharts.com/modules/exporting.js"></script>
	<script src="https://code.highcharts.com/modules/export-data.js"></script>
	<script src="https://code.highcharts.com/modules/accessibility.js"></script>

	<script>
		var i = 1;
		var team_score =[]
		while (1) {
			score = document.getElementById(i)
			if (score === null) {
				break;
			}
			team_score.push(parseInt(score.innerText));
			i++;
		}
		Highcharts.chart('team_score_plot', {
			title: {
				text: 'Group Weekly Score'
			},
			yAxis: {
				title: {
					text: 'Weekly Score '
				},
				min:0,
				tickInterval:1,
				max:5
			},

			xAxis: {
				accessibility: {
					rangeDescription: 'Week'
				},
				min:1,
				tickInterval:1,
			},

			legend: {
				layout: 'vertical',
				align: 'right',
				verticalAlign: 'middle'
			},

			plotOptions: {
				series: {
					label: {
						connectorAllowed: false
					},
					pointStart: 1
				}
			},

			series: [{
				name: '',
				data: team_score
			}],

			legend: {
				enabled: false
			},

			responsive: {
				rules: [{
					condition: {
						maxWidth: 500
					},
					chartOptions: {
						legend: {
							layout: 'horizontal',
							align: 'center',
							verticalAlign: 'bottom'
						}
					}
				}]
			}

		});
	</script>
	<script>
		var year_dropsown_list_html = ''
		var date = new Date()
		var cur_year = parseInt(date.getFullYear())
		for (var i=0; i<4; i++) {
			year_dropsown_list_html = year_dropsown_list_html + '<li class="imyeah"><a href="#">Year '+(cur_year-i)+'</a>\n' +
					'\t\t\t\t\t\t\t\t\t\t<ul class="level2">\n' +
					'\t\t\t\t\t\t\t\t\t\t\t<li>select a semester</li>\n' +
					'\t\t\t\t\t\t\t\t\t\t\t<li><a href="lecturer_setYS?YS='+(cur_year-i)+'-1">1</a></li>\n' +
					'\t\t\t\t\t\t\t\t\t\t\t<li><a href="lecturer_setYS?YS='+(cur_year-i)+'-2">2</a></li>\n' +
					'\t\t\t\t\t\t\t\t\t\t\t<li><a href="lecturer_setYS?YS='+(cur_year-i)+'-3">3</a></li>\n' +
					'\t\t\t\t\t\t\t\t\t\t</ul>\n' +
					'\t\t\t\t\t\t\t\t\t</li><br>'
		}
		document.getElementById("year_semester").innerHTML = year_dropsown_list_html
	</script>
	<script>
		var stu_weekly_feedback = document.getElementById("weekly_feedback").value  //获取{{teamFeedback}}，赋值给stu_weekly_feedback
		stu_weekly_feedback = JSON.parse(stu_weekly_feedback)
		// console.log(typeof stu_weekly_feedback)
		// console.log(stu_weekly_feedback.length)
		var stu_weekly_feedback_html = ""
		//循环一次，为一个modal插入对应周的数据
		for (var i = 0; i < stu_weekly_feedback.length; i++) {  //判断第i行是否有数据，有则说明该周有数据
			for (var n = 1; n <= stu_weekly_feedback[i][5]; n++) {  //stu_weekly_feedback[i][4]为该组人数，n代表第n个组员，for循环遍历每个组员
				var weekNumber = stu_weekly_feedback[i][1]    //获取该行周数
				stu_weekly_feedback_html = stu_weekly_feedback_html +
						"                         <tr>\n" +
						"                            <td style=\"vertical-align: middle\" readonly=\"readonly\">"+stu_weekly_feedback[i][2+4*n]+"</td>\n" +   //获取第n个组员姓名
						"                            <td style=\"vertical-align: middle\" readonly=\"readonly\">"+weekNumber+"</td>\n" +
						"                            <td style=\"vertical-align: middle\" readonly=\"readonly\">"+stu_weekly_feedback[i][3+4*n]+"</td>\n" +  //获取第n个组员score
						"                            <td style=\"vertical-align: middle\">"+stu_weekly_feedback[i][4+4*n]+"%</td>\n" +  //获取第n个组员contribution
						"                            <td style=\"vertical-align: middle\">"+stu_weekly_feedback[i][5+4*n]+"%</td>\n" +  //获取第n个组员feedback
						"                        </tr>"
			}
			// for 循环后获得本组所有人该周成绩的 table html
			id = "stu_feedback_html_week"+(i+1)
			console.log(id)
			document.getElementById(id).innerHTML = stu_weekly_feedback_html    //将该周的html插入对应的modal
			stu_weekly_feedback_html = ""  //将html变量清空，准备下一次while循环
		}
	</script>
	</body>
</html>
